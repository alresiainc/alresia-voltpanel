version: 2 # << mandatory for v2 config
project_name: voltpanel

# Run this before building (e.g., build frontend)
before:
  hooks:
    - make ui-build

builds:
  - id: voltpanel
    main: ./cmd/voltpanel
    binary: voltpanel
    env:
      - CGO_ENABLED=0
    goos: [linux, darwin, windows]
    goarch: [amd64, arm64]
    ldflags:
      - -s -w
    flags: ["-trimpath"]

archives:
  - id: default
    builds: [voltpanel]
    format_overrides:
      - goos: windows
        format: zip

nfpms:
  - id: linux-packages
    builds: [voltpanel]
    formats: [deb, rpm]
    maintainer: "Alresia <dev@alresia.com>"
    description: "Alresia VoltPanel local server management daemon"
    license: MIT
    vendor: Alresia
    homepage: https://alresia.com
    contents:
      - src: ./dist/voltpanel
        dst: /usr/bin/voltpanel
        file_info:
          mode: 0755
      - src: ./packaging/devpanel.service
        dst: /lib/systemd/system/devpanel.service
    scripts:
      postinstall: packaging/scripts/postinstall.sh

brews:
  - name: voltpanel
    repository:
      owner: alresiainc
      name: homebrew-tap
    directory: Formula
    description: "Alresia VoltPanel local server management daemon"
    homepage: https://alresia.com
    service: |
      run [opt_bin/"voltpanel"]
      keep_alive true
      log_path var/"log/voltpanel.log"
      error_log_path var/"log/voltpanel.log"
    test: |
      system "voltpanel", "-h"

checksum:
  name_template: "checksums.txt"

snapshot:
  name_template: "{{ incpatch .Version }}-next"

changelog:
  disable: true
